syntax = "proto3";

package tz.v1;

option go_package = "repairCopilotBot/tz-bot/proto/tz/v1;tzv1";


service TzService {
  rpc CheckTz(CheckTzRequest) returns (CheckTzResponse);
  rpc GetTechnicalSpecificationVersions(GetTechnicalSpecificationVersionsRequest) returns (GetTechnicalSpecificationVersionsResponse);
  rpc GetAllVersions(GetAllVersionsRequest) returns (GetAllVersionsResponse);
  rpc GetVersionStatistics(GetVersionStatisticsRequest) returns (GetVersionStatisticsResponse);
  rpc GetVersion(GetVersionRequest) returns (GetVersionResponse);
  rpc NewFeedbackError(NewFeedbackErrorRequest) returns (NewFeedbackErrorResponse);
}

message CheckTzRequest {
  bytes file = 1;
  string filename = 2;
  string request_id = 3;
}

message CheckTzResponse {
  string html_text = 1;
  string css = 2;
  string docId = 3;
  repeated OutInvalidError invalid_errors = 4;
  repeated OutMissingError missing_errors = 5;
  string fileId = 6;
  repeated Error errors = 7;
}

message OutInvalidError {
  uint32 id = 1;
  string id_str = 2;
  string group_id = 3;
  string error_code = 4;
  string quote = 5;
  string analysis = 6;
  string critique = 7;
  string verification = 8;
  string suggested_fix = 9;
  string rationale = 10;
  string original_quote = 11;
  repeated string quote_lines = 12;
  bool until_the_end_of_sentence = 13;
  optional int32 start_line_number = 14;
  optional int32 end_line_number = 15;
}

message OutMissingError {
  uint32 id = 1;
  string id_str = 2;
  string group_id = 3;
  string error_code = 4;
  string analysis = 5;
  string critique = 6;
  string verification = 7;
  string suggested_fix = 8;
  string rationale = 9;
}

message Instance {
  optional string err_type = 1;
  optional string snippet = 2;
  optional int32 line_start = 3;
  optional int32 line_end = 4;
  optional string suggested_fix = 5;
  optional string rationale = 6;
}

message Error {
  string id = 1;
  string group_id = 2;
  string error_code = 3;
  optional string preliminary_notes = 4;
  optional string overall_critique = 5;
  string verdict = 6;
  optional string process_analysis = 7;
  optional string process_critique = 8;
  optional string process_verification = 9;
  repeated string process_retrieval = 10;
  repeated Instance instances = 11;
}

message GetTechnicalSpecificationVersionsRequest {
  string user_id = 1;
}

message GetTechnicalSpecificationVersionsResponse {
  repeated TechnicalSpecificationVersion versions = 1;
}

message TechnicalSpecificationVersion {
  string version_id = 1;
  string technical_specification_name = 2;
  int32 version_number = 3;
  string created_at = 4;
}

message GetVersionRequest {
  string version_id = 1;
}

message GetVersionResponse {
  string html_text = 1;
  string css = 2;
  string docId = 3;
  repeated OutInvalidError invalid_errors = 4;
  repeated OutMissingError missing_errors = 5;
  string fileId = 6;
}

message GetAllVersionsRequest {
  // No parameters needed - returns all versions
}

message GetAllVersionsResponse {
  repeated VersionWithErrorCounts versions = 1;
}

message VersionWithErrorCounts {
  string version_id = 1;
  string technical_specification_id = 2;
  string technical_specification_name = 3;
  string user_id = 4;
  int32 version_number = 5;
  string created_at = 6;
  string updated_at = 7;
  string original_file_id = 8;
  string out_html = 9;
  string css = 10;
  string checked_file_id = 11;
  optional double all_rubs = 12;
  optional int64 all_tokens = 13;
  optional int64 inspection_time_nanoseconds = 14;
  int32 invalid_error_count = 15;
  int32 missing_error_count = 16;
}

message GetVersionStatisticsRequest {
  // No parameters needed - returns statistics for all versions
}

message GetVersionStatisticsResponse {
  VersionStatistics statistics = 1;
}

message VersionStatistics {
  int64 total_versions = 1;
  optional int64 total_tokens = 2;
  optional double total_rubs = 3;
  optional int64 average_inspection_time_nanoseconds = 4;
}

message NewFeedbackErrorRequest {
  string version_id = 1;
  string error_id = 2;
  string error_type = 3;
  uint32 feedback_type = 4;
  string comment = 5;
  string user_id = 6;
}

message NewFeedbackErrorResponse {

}