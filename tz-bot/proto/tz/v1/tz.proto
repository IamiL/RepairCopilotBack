syntax = "proto3";

package tz.v1;

option go_package = "repairCopilotBot/tz-bot/proto/tz/v1;tzv1";


import "google/protobuf/timestamp.proto";

service TzService {
  rpc CheckTz(CheckTzRequest) returns (CheckTzResponse);
  rpc GetTechnicalSpecificationVersions(GetTechnicalSpecificationVersionsRequest) returns (GetTechnicalSpecificationVersionsResponse);
  rpc GetAllVersions(GetAllVersionsRequest) returns (GetAllVersionsResponse);
  rpc GetVersionStatistics(GetVersionStatisticsRequest) returns (GetVersionStatisticsResponse);
  rpc GetVersion(GetVersionRequest) returns (GetVersionResponse);
  rpc NewFeedbackError(NewFeedbackErrorRequest) returns (NewFeedbackErrorResponse);
}

message CheckTzRequest {
  bytes file = 1;
  string filename = 2;
  string request_id = 3;
}

message CheckTzResponse {
  string id = 1;
  string name = 2;
  google.protobuf.Timestamp created_at = 3;
}

message Error {
  string id = 1;
  string group_id = 2;
  string error_code = 3;
  string name = 4;
  string description = 5;
  string detector = 6;
  optional string preliminary_notes = 7;
  optional string overall_critique = 8;
  string verdict = 9;
  optional string process_analysis = 10;
  optional string process_critique = 11;
  optional string process_verification = 12;
  repeated string process_retrieval = 13;
  repeated InvalidInstance invalid_instances = 14;
  repeated MissingInstance missing_instances = 15;
  int32 order_number = 16;
}

message InvalidInstance {
  string id = 1;
  uint32 html_id = 2;
  string error_id = 3;
  string rationale = 4;
  string quote = 5;
  string suggested_fix = 6;
  string original_quote = 7;
  repeated string quote_lines = 8;
  bool until_the_end_of_sentence = 9;
  optional int32 start_line_number = 10;
  optional int32 end_line_number = 11;
  string system_comment = 12;
  int32 order_number = 13;
  optional Error parent_error = 14;
  bool feedback_exists = 16;
  optional bool feedback_mark = 17;
  optional string feedback_comment = 18;
  optional string feedback_user = 19;
  bool feedback_verification_exists = 20;
  optional bool feedback_verification_mark = 21;
  optional string feedback_verification_comment = 22;
  optional string feedback_verification_user = 23;
}

message MissingInstance {
  string id = 1;
  uint32 html_id = 2;
  string error_id = 3;
  string suggested_fix = 4;
  string rationale = 5;
  bool feedback_exists = 16;
  optional bool feedback_mark = 17;
  optional string feedback_comment = 18;
  optional string feedback_user = 19;
  bool feedback_verification_exists = 20;
  optional bool feedback_verification_mark = 21;
  optional string feedback_verification_comment = 22;
  optional string feedback_verification_user = 23;
}

message GetTechnicalSpecificationVersionsRequest {
  string user_id = 1;
}

message GetTechnicalSpecificationVersionsResponse {
  repeated TechnicalSpecificationVersion versions = 1;
}

message TechnicalSpecificationVersion {
  string version_id = 1;
  string technical_specification_name = 2;
  int32 version_number = 3;
  string created_at = 4;
}

message GetVersionRequest {
  string version_id = 1;
}

message GetVersionResponse {
  optional string html_text = 1;
  optional string css = 2;
  optional string docId = 3;
  optional string fileId = 4;
  repeated Error errors = 5;
  repeated InvalidInstance invalid_instances = 6;
  google.protobuf.Timestamp created_at = 7;
  optional double total_rubs = 8;
  optional int64 total_tokens = 9;
  optional int64 average_inspection_time_nanoseconds = 10;
  optional int64 original_file_size = 11;
  optional int32 numberOfErrors = 12;
  string name = 13;
  string status = 14;
}

message GetAllVersionsRequest {
  // No parameters needed - returns all versions
}

message GetAllVersionsResponse {
  repeated VersionWithErrorCounts versions = 1;
}

message VersionWithErrorCounts {
  string version_id = 1;
  string technical_specification_id = 2;
  string technical_specification_name = 3;
  string user_id = 4;
  int32 version_number = 5;
  string created_at = 6;
  string updated_at = 7;
  string original_file_id = 8;
  string out_html = 9;
  string css = 10;
  string checked_file_id = 11;
  optional double all_rubs = 12;
  optional int64 all_tokens = 13;
  optional int64 inspection_time_nanoseconds = 14;
  int32 invalid_error_count = 15;
  int32 missing_error_count = 16;
}

message GetVersionStatisticsRequest {
  // No parameters needed - returns statistics for all versions
}

message GetVersionStatisticsResponse {
  VersionStatistics statistics = 1;
}

message VersionStatistics {
  int64 total_versions = 1;
  optional int64 total_tokens = 2;
  optional double total_rubs = 3;
  optional int64 average_inspection_time_nanoseconds = 4;
}

message NewFeedbackErrorRequest {
  string instance_id = 1;
  string instance_type = 2;
  optional bool feedback_mark = 3;
  optional string feedback_comment = 4;
  string user_id = 5;
}

message NewFeedbackErrorResponse {
}